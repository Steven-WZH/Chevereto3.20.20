$(function(){setInterval(function(){var t=$(".animated-ellipsis"),a=t.html();a+=".",a.length>3&&(a=""),t.html(a)},400),update.process()});var update={vars:{},process:function(t){var a=this;a.addLog(PF.fn._s("Installed version is v%s",vars.current_version)),$.ajax({url:vars.url,data:{action:"ask"}}).always(function(t,e,n){void 0!==t.status_code&&n?200==t.status_code?(a.addLog(PF.fn._s("Last available release is v%s",t.software.current_version)),-1==PF.fn.versionCompare(vars.current_version,t.software.current_version)?(a.vars.target_version=t.software.current_version,a.addLog(PF.fn._s("Update needed, proceeding to download")),a.download(function(){a.extract(function(){a.install()})})):($("h1").html(PF.fn._s("No update needed")),a.addLog(PF.fn._s("System files already up to date",vars.current_version)),a.install())):a.abort("error"in t&&"message"in t.error?t.error.message:e,400):a.abort(PF.fn._s("Can't connect to %s","internal API (action:ask)"),100)})},download:function(t){var a=this;a.addLog(PF.fn._s("Starting v%s download",this.vars.target_version)),$.ajax({url:vars.url,data:{action:"download",version:a.vars.target_version}}).always(function(e,n,o){void 0!==e.status_code&&o?200==e.status_code?(a.vars.target_filename=e.download.filename,a.addLog(PF.fn._s("Downloaded v%s, proceeding to extraction",a.vars.target_version)),"function"==typeof t&&t()):a.abort("error"in e&&"message"in e.error?e.error.message:n,400):a.abort(PF.fn._s("Can't connect to %s","internal API (action:download)"),100)})},extract:function(t){var a=this;a.addLog(PF.fn._s("Attempting to extract v%s",this.vars.target_version)),$.ajax({url:vars.url,data:{action:"extract",file:a.vars.target_filename}}).always(function(e,n,o){o?200==e.status_code?(a.addLog(PF.fn._s("Extraction completed",a.vars.target_version)),setTimeout(function(){a.addLog(PF.fn._s("Proceding to install the update",a.vars.target_version)),"function"==typeof t&&t()},500)):a.abort(e.responseJSON.error.message,400):a.abort(PF.fn._s("Can't connect to %s",vars.url),400)})},install:function(){setTimeout(function(){window.location=PF.obj.config.base_url+"/install"},2e3)},addLog:function(t,a){a||(a=200);var e=$("ul"),n=PF.fn.getDateTime().substring(11),o=$("<li/>",{class:200!=a?"color-red":null,text:n+" "+t});e.prepend(o)},abort:function(t){$("h1").html(PF.fn._s("Update failed")),t&&this.addLog(t,400)}};